<!DOCTYPE html>
<html lang="de-DE">
    <head>
        <meta charset="UTF-8" />
        <title>ZUGFeRD Dokumentation und API Dokumentation</title>
        <link type="text/css" rel="stylesheet" href="style.css" />
    </head>
    <body>
        
        <h1>ZUGFeRD Dokumentation</h1>
        
        <h2>Das ZUGFeRD Format</h2>
        
        <p>ZUGFeRD ist ein von FeRD (Forums elektronische Rechnung Deutschland) entwickelter
        Standard um die Erstellung und Verbreitung von elektronischen Rechnungen zu vereinheitlichen.
        Dabei wird ein XML Format verwendet, welches die elektronische Rechnungsprüfung ermöglicht.
        Das XML wird hierbei von PDFreactor über die ZUGFeRD API erzeugt und der Benutzer selbst muss sich
        nicht mit dem XML auseinandersetzen.</p>
        
        <h3>ZUGFeRD Profil</h3>
        
        <p>PDFreactor unterstützt zwei der drei von FeRD definierten Profile: <code>basic</code> 
        und <code>comfort</code>. Das dritte Profil <code>extended</code> wird zurzeit nicht 
        unterstützt. Das Profil bestimmt welche ZUGFeRD-Properties generiert werden und welche 
        nicht. Ohne ein Profil kann das ZUGFeRD PDF nicht erzeugt werden und die Konvertierung 
        wird mit einer entsprechenden Exception terminiert.</p>
        <p>Ist das ZUGFeRD Profil <code>basic</code>, so werden keine Properties
        des Profils <code>comfort</code> erzeugt, selbst wenn diese angegeben wurden. Ist das Profil
        jedoch <code>comfort</code>, so werden Properties des Profils <code>basic</code> generiert, 
        wenn diese angegeben wurden. Außerdem gibt es Properties die immer benötigt
        werden um ein ZUGFeRD PDF zu erstellen. Diese Properties benötigen das Profil
        <code>basic</code> und müssen über die ZUGFeRD API angegeben werden. Weiterhin ist
        anzumerken, dass höhere Profile keine weiteren Properties benötigen damit ein ZUGFeRD PDF
        erstellt wird. Es ist also möglich ein ZUGFeRD PDF mit dem Profil <code>comfort</code>
        zu erzeugen und dabei <code>basic</code> Properties anzugeben.</p>
        
        <table>
            <thead>
                <tr>
                    <th>Profil</th>
                    <th>Beschreibung</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><code>basic</code></td>
                    <td>Das niedrigste ZUGFeRD Profil.
                    Ermöglicht es benötigte Informationen anzugeben.
                    Vollständige elektronische Validierung ist nicht vorausgesetzt.</td>
                </tr>
                <tr>
                    <td><code>comfort</code></td>
                    <td>Höherer Level als <code>basic</code>.
                    Ermöglicht genauere Angaben, vor allem in Bezug auf Positionen.
                    Ermöglicht zu einem gewissen Maße die elektronische Validierung.</td>
                </tr>
            </tbody>
        </table>
        
        <h3>PDF und XML</h3>
        
        <p>Ein ZUGFeRD PDF besteht aus zwei Teilen, dem PDF und dem XML.
        Alles was im PDF zu sehen ist, kann in das XML generiert werden. Auch wenn die API es
        erlaubt beliebige gültige Werte auf jedes Property zu setzen, besagt die ZUGFeRD Spezifikation, 
        dass nur Informationen angegeben werden dürfen, die im PDF zu sehen sind oder von 
        diesen Informationen abgeleitet werden können. Ein Beispiel für den letzteren Fall ist das
        Land, welches im XML als 2-stelliger ZUGFeRD Code angegeben werden muss.
        Im Rückschluss bedeutet das, dass ZUGFeRD-Properties, die für das ZUGFeRD PDF benötigt werden
        und nicht über das PDF angegeben werden können, zu einem fehlerhaften PDF und XML führen.
        Es gibt natürlich Fälle in denen die Informationen womöglich nicht im PDF vorliegen, wie
        z.B. die Properties <code>zugferd-profile</code> oder <code>test-indicator</code>.</p>
        
        <h3>Voraussetzungen</h3>
        
        <p>Um das ZUGFeRD PDF zu erzeugen, müssen zuerst einige Voraussetzungen erfüllt werden.</p>
        
        <h4>PDF/A3 Conformance Level</h4>
        
        <p>Für ZUGFeRD muss zunächst ein PDF Standard gewählt werden, der Langzeitarchivierung
        ermöglicht, wie z.B. PDF/A. Der PDF Standard muss außerdem Anhänge erlauben, was die
        Optionen auf die Standards PDF/A-3a, PDF/A-3b, PDF/A-3u und PDF/A-3a mit der 
        PDF/UA-1 Spezifikation, einschränkt.</p>
        
        <h4>JavaScript Verarbeitung</h4>
        
        <p>Um das ZUGFeRD PDF aus dem PDF zu erzeugen, muss das JavaScript angegeben werden.
        Dies kann entweder im Dokument oder über die PDFreactor API angegeben werden.
        Damit das JavaScript verarbeitet wird, muss zunächst jedoch die JavaScript-Verarbeitung
        für PDFreactor aktiviert werden.</p>
        
        <p>Das folgende Beispiel beinhaltet alle Voraussetzungen, damit PDFreactor ein ZUGFeRD
        PDF mit Hilfe der Java Bibliothek oder dem Java Wrapper erzeugen kann:</p>
        
        <div class="example">// Erzeugung des configuration Objekts
Configuration config = new Configuration();

// Angabe der Conformance
config.setConformance(Conformance.PDFA3A);

// JavaScript Aktivierung
config.setJavaScriptMode(JavaScriptMode.ENABLED);

// Angabe des JavaScripts via file URL
Resource zugferd = new Resource();
zugferd.setUri("file:///path/to/your/zugferd.js");
config.setUserScripts(zugferd);
</div>
        
        <h3>ZUGFeRD Validierung</h3>
        
        <p>PDFreactor validiert keine Preise oder Gesamtbeträge, die über die ZUGFeRD API angegeben
        wurden. Bei der Verwendung der API wird von PDFreactor erwartet, dass alle Positionen,
        Steuern und Beträge richtig berechnet wurden. Ansonsten wäre das Dokument nicht valide.
        Einige Properties werden jedoch validiert. Das schließt zum Großteil die Properties
        ein, die als ZUGFeRD Code angegeben werden müssen, wie z.B. <code>document-type</code>
        oder der Länder-Code. Dies schließt Codes mit ein, die über das <a href="#options">options Objekt</a>
        gesetzt werden. Außerdem werden durch die ZUGFeRD Spezifikation angegebene Sonderfälle validiert,
        wie z.B. die Elemente <code>GrossPrice</code> und <code>NetPrice</code>.</p>
        
        <h2>Die zwei Elementtypen</h2>
        
        <p>Bevor die API verwendet werden kann, müssen zunächst die beiden Elementtypen geklärt werden.
        Einmalige und wiederholende Elemente, beide folgen einer Baumstruktur.</p>
        
        <h3 id="unique">Einmalige Elemente</h3>
        
        <p>Einmalige Elemente sind Blattelemente, die direkt über den Root verbunden sind.
        Diese Elemente können nur einmal über die API gesetzt werden, sind jedoch die
        wichtigsten Elemente. Es ist sogar möglich ein ZUGFeRD PDF nur mit einmaligen Elementen
        zu erstellen. Beispiele für einmalige Elemente sind <code>currency</code>, um die
        dokumentenweite Währung zu definieren oder <code>document-type</code>, um die 
        Art des Dokuments, z.B. Rechnung, per ZUGFeRD Code zu beschreiben.</p>
        
        <h3 id="repeating">Wiederholende Elemente</h3>
        
        <p>Auch wenn wiederholende Elemente nicht benötigt werden um das ZUGFeRD PDF zu erstellen,
        bieten sie die Möglichkeit mehr Informationen anzugeben. Diese Elemente können je 
        nach Dokument einmal oder auch mehrmals angegeben werden. Wiederholende
        Elemente sind selbst nicht mit dem Root verbunden, bilden jedoch Verzweigungen an denen
        wiederum Blattelemente zu finden sind. Als Beispiel für ein wiederholendes Element sind Positionen.
        Diese bilden eine Verzweigung über den <a href="#path">Pfad</a> <code>item</code>.
        Die Blattelemente wiederum beinhalten die Informationen wie z.B. den Name des Produkts
        (<code>item.name</code>) oder die Menge (<code>item.billed-quantity</code>).</p>
        
        <p>Es ist auch möglich, dass eine weitere Verzweigung für ein weiteres wiederholendes Element,
        an einer bestehenden Verzweigung gebildet wird. Dies sind verschachtelte wiederholende Elemente.
        Die Schachtelung wird bei der <a href="#usingProperty">Benutzung der ZUGFeRD-Properties</a>
        ersichtlich. Es gibt zudem noch eine Einschränkung, welche Blattelemente angegeben werden
        müssen. Z.B. ist die wichtigste Information einer Position der Name des Produkts (<code>item.name</code>)
        und muss daher gesetzt werden, damit diese Position generiert wird.
        Wenn möglich sollten weitere Informationen angegeben werden, 
        diese sind jedoch nicht verpflichtend.</p>
        
        
        <h2 id="usingProperty">Verwendung von ZUGFeRD-Properties</h2>
        
        <p>Um anzugeben welches Element mit welchem Wert beschrieben werden soll, 
        werden ZUGFeRD-Properties benötigt. Diese ZUGFeRD-Properties können zudem noch  
        in Pfade und Properties fragmentiert werden. Auch wenn für die meisten Dokumente 
        keine Fragmente benötigt werden, können diese bei der richtigen Benutzung hilfreich sein.
        Alle gültigen ZUGFeRD-Properties sind in der Property-Dokumentation zu finden.</p>
        
        <h3 id="fragments">Fragmente</h3>
        
        <p>Ein ZUGFeRD-Property besteht immer aus mindestens einem Fragment.
        Durch das Teilen eines ZUGFeRD-Propertys an dem "<code>.</code>" wird die 
        Baumstruktur des Propertys ersichtlich. Hierbei kann auch sofort unterschieden werden,
        ob es sich bei dem ZUGFeRD-Property um ein einmaliges oder ein wiederholendes
        Element handelt.</p>
        
        <div class="example">// Fragmentieren eines ZUGFeRD-Propertys
"zugferd-profile"   = "zugferd-profile"
"item.name"         = "item", "name"
"item.tax.type"     = "item", "tax", "type"</div>
        
        <p>Besitzt ein ZUGFeRD-Property, wie z.B. "zugferd-profile", keinen "<code>.</code>", 
        so ist es automatisch ein Property für ein einmaliges Element.</p>
        
        <h3 id="path">Pfad Fragment</h3>
        
        <p>Alle Fragmente mit Ausnahme des letzten, sind Pfade.
        Diese Pfade werden genutzt um einzelne oder mehrere wiederholende Elemente zu 
        spezifizieren. Der Grund dafür ist, dass wiederholende Elemente selbst keine Werte 
        haben können. Nur ihre Blattelemente können Werte haben. Mit Pfaden ist es somit 
        möglich die Baumstruktur anzugeben.</p>
        
        <div class="example">// Pfad "item" 
ro.zugferd.get("item", 0);</div>
        
        <p>Beinhaltet ein ZUGFeRD-Property mehr als einen "<code>.</code>" so handelt es 
        sich um ein wiederholendes Element innerhalb eines wiederholenden Elements. Dabei 
        gilt es zu beachten, dass es sich hierbei um zwei Pfade handelt. Es ist nicht
        erlaubt diese beiden Pfade als einen Pfad anzugeben. Stattdessen wird der erste
        Pfad dazu benutzt um ein wiederholendes Element über das
        <code>ro.zugferd</code> Objekt abzufragen. Der Zweite Pfad wird dann verwendet
        um von diesem Element wiederum ein wiederholendes Element abzufragen.</p>
        
                <div class="example">// Pfad "item.tax"
var item = ro.zugferd.get("item", 0);

item.get("tax", 0);</div>
        
        <p>Da Einmalige Elemente nur einmal im Dokument vorkommen, besitzen diese 
        ZUGFeRD-Properties keinen "<code>.</code>".</p>
        
        <h3 id="property">Property Fragment</h3>
        
        <p>Das letzte Fragment oder das ZUGFeRD-Property persönlich, falls das ZUGFeRD-Property 
        keine "<code>.</code>" beinhaltet, ist das Property. Dieses Fragment definiert das 
        Blattelement welches den angegebenen oder ausgelesenen Wert erhalten soll.</p>
        
        <div class="example">// Einmalige Elemente
ro.zugferd.set("zugferd-profile", "basic");

// Wiederholende Elemente
ro.zugferd.get("item", 0).set("name", "Sample Product");

// Verschachtelte wiederholende Elemente
ro.zugferd.get("item", 0).get("tax", 0).set("type", "VAT");</div>
        
        <h3>Wann werden Fragmente benötigt?</h3>
        
        <p>In den meisten Fällen werden Fragmente nicht benötigt. Ein komplexes Dokument kann 
        auch ohne Fragmentierung eines ZUGFeRD-Propertys in ein ZUGFeRD PDF umgewandelt werden.
        Fragmente werden nur benötigt, um einen Wert auf ein bestimmtes wiederholendes Element 
        zu setzen. Sobald eine <code>get</code> Methoden des "ro.zugferd" Objekts mit dem 
        ersten Fragment aufgerufen wurde, um ein wiederholendes Element zu erhalten, benötigen 
        alle Methoden die auf diesem wiederholenden Element aufgerufen werden, das nächste 
        Fragment des ZUGFeRD-Propertys. Beispiel:</p>
        
        <div class="example">&lt;table&gt;
    &lt;thead&gt;
        &lt;tr&gt;
            &lt;th&gt;Produkt&lt;/th&gt;
            &lt;th&gt;Preis&lt;/th&gt;
        &lt;/tr&gt;
    &lt;thead&gt;
    &lt;tbody&gt;
        &lt;tr class="item"&gt;
            &lt;td&gt;Position 1&lt;/td&gt;
            &lt;td&gt;50.00&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr class="item"&gt;
            &lt;td&gt;Position 2&lt;/td&gt;
            &lt;td&gt;4.99&lt;/td&gt;
        &lt;/tr&gt;
    &lt;/tbody&gt;
&lt;/table&gt;</div>
        
        <p>Diese Tabelle kann mit oder ohne Fragmente in das ZUGFeRD PDF umgewandelt werden.</p>
        
        <div class="example">// Ohne Fragmente
// Setzen der Produktnamen
ro.zugferd.setFromSelectorAll("item.name", ".item td:nth-child(0)");
    
// Setzen der Produktpreise
ro.zugferd.setFromSelectorAll("item.line-total", ".item td:nth-child(1)", { inputFormat: "." } );
    
    
// Mit Fragmenten unter der Voraussetzung, dass mindestens zwei Elemente mit dem Pfad vorhanden sind.
// Erhalten aller Elemente mit dem Pfad "item".
var items = ro.zugferd.get("item");
    
// Iterieren über das Array items
for (var i = 0; i &lt; items.length; i++) {
    
    // Setzen der Produktnamen
    items[i].setFromSelector("name", ".item:nth-child(" + i + ") td:nth-child(0)");
    
    // Setzen der Produktpreise
    items[i].setFromSelector("line-total", ".item:nth-child(" + i + ") td:nth-child(1)", { inputFormat: "." } );
}</div>
        
        <p>Wie zu sehen ist, sind beide Wege möglich. Fragmente bringen jedoch eine gewisse 
        Komplexität mit sich und sollten nur dann benutzt werden, wenn der Fall danach 
        verlangt.</p>
        
        <h2>Sonderfälle</h2>
        
        <p>Auch wenn die API so einfach wie möglich gehalten werden soll, bedürfen manche Elemente 
        und Properties mehr Aufmerksamkeit als andere. Dies liegt zum einen an der ZUGFeRD 
        Spezifikation, zum anderen an der Implementierung in PDFreactor.</p>
        
        <h3>Steuer und Umsatzsteuernummer</h3>
        
        <p>Die ZUGFeRD Spezifikation sieht hier eine uneingeschränkte Angabe von Registrierungen 
        pro beteiligter Partei vor. PDFreactor limitiert dies jedoch auf zwei Properties.
        Im Fall des Verkäufers, wären diese <code>seller-vatid</code> und <code>seller-taxid</code>.</p>
        
        <h3>Die Elemente Gross- und NetPrice</h3>
        
        <p>Die Elemente Gross- und NetPrice, werden immer zusammen erzeugt, auch wenn nur 
        eines davon per ZUGFeRD-Property <code>item.gross-price-amount</code> oder <code>item.net-price-amount</code>
        angegeben wurde. Solange nicht das ZUGFeRD-Property <code>item.gross-price-allowance-charge.amount</code>
        angegeben wurde, welches einen Zu- oder Abschlag definiert, sind Gross- und NetPrice gleich.
        Wurde <code>item.gross-price-allowance-charge.amount</code> jedoch angegeben, dürfen 
        Gross- und NetPrice nicht mehr identisch sein. In diesem Fall würde kein ZUGFeRD PDF 
        generiert und eine entsprechende Fehlermeldung ausgegeben werden.</p>
        
        <h3>Referenzierte Dokumente</h3>
        
        <p>Ein Dokument kann als Referenz im ZUGFeRD PDF angegeben werden.
        Dies wäre z.B. bei einer Stornierung die vorher gesendete Rechnung.
        Bei der Angabe eines referenzierten Dokuments wird das <a href="#options">options Objekt</a>
        Property benötigt um das aktuelle Datumsformat anzugeben, jedoch nicht das Property scheme.
        Dieses wird von der ZUGFeRD Spezifikation auf den Wert <code>yyyy-MM-dd'T'00:00:00</code> festgelegt.</p>
        
        <h3>document-type</h3>
        
        <p>Um die Art des Dokuments per ZUGFeRD Code anzugeben, wird das Property <code>document-type</code>
        genutzt. Auch wenn es sich beim Dokument nicht um eine Handelsrechnung handelt, kann im 
        ZUGFeRD Profil <code>basic</code> nur der ZUGFeRD Code <code>380</code> angegeben werden.
        Andere Dokumentenarten benötigen möglicherweise mehr Informationen, die nicht im basic 
        Profile angegeben werden können.</p>
        
        <h3>charge-total und allowance-total</h3>
        
        <p>Per ZUGFeRD Spezifikation werden diese beiden ZUGFeRD-Properties benötigt um das ZUGFeRD
        PDF zu generieren. Auch wenn diese benötigt werden, setzt PDFreactor diese Properties
        automatisch mit dem Wert <code>0.00</code>, da es möglicherweise nicht möglich ist diese
        Properties immer über das PDF zu setzen. Sollten diese beiden Properties jedoch über
        das PDF angegeben werden können, so sollten diese auch gesetzt werden um die Korrektheit
        des ZUGFeRD PDFs zu gewährleisten.</p>
        
        <h3>item.global-id-type</h3>
        
        <p>Bei der Angabe eines ZUGFeRD-Propertys mit dem Typ <code>Global ID</code>, wird 
        im Normalfall der ZUGFeRD Code für die Organisation über das <a href="#options">options Objekt</a> 
        Property scheme gesetzt. Die einzige Ausnahme bildet hier das ZUGFeRD-Property <code>item.global-id</code>.
        Der ZUGFeRD Code für die Organisation wird hier gesondert über das ZUGFeRD-Property 
        <code>item.global-id-type</code> gesetzt um zu verhindern, dass beim Setzen nicht erwünschte 
        Ergebnisse entstehen, die später mühsam korrigiert werden müssen.</p>
        
        <h3>mandate-reference-id</h3>
        
        <p>Sollte das ZUGFeRD-Property <code>mandate-reference</code> angegeben werden, so 
        ist es möglich für diesen Gläubiger eine ID zu hinterlegen. Diese <code>mandate-reference-id</code> 
        wird jedoch vom Gläubiger selbst vergeben und muss genutzt werden. Das 
        ZUGFeRD-Property <code>mandate-reference-id</code> wird jedoch nicht benötigt um <code>mandate-reference</code>
        zu generieren.</p>
        
        <h1>API Methoden</h1>
        
        <h2>ro.zugferd</h2>
        
        <p>Um mit der ZUGFeRD API zu interagieren, wird das <code>ro.zugferd</code> Objekt
        benötigt. Mit diesem Objekt ist es möglich, bestimmte Werte zu konfigurieren,
        <a href="#defaults">Standardwerte</a> für wiederholende Elemente anzugeben sowie
        für das Standardeingabe- und Ausgabeformat festzulegen. Außerdem können einmalige
        und wiederholende Elemente gesetzt und wiederholende Elemente abgefragt werden.
        </p>
        
        <div>
            <h3>addMapping(key, value, <a href="#options">options</a>?)</h3>
            
            <p>Mappings werden verwendet um einen bestimmten Wert, anstelle des Werts der 
            der Wert der einer Methode übergeben wurde, zu setzen, sofern dieser Wert identisch
            zum angegebenen Key ist. Dies ist 
            vor allem dann von Interesse wenn der zu setzende Wert zwar menschenlesbar ist, 
            von dem ZUGFeRD-Property jedoch ein ZUGFeRD Code verlangt wird. Es gilt zu beachten, 
            dass der Key zwischen Groß- und Kleinschreibung unterscheidet und Leerzeichen 
            berücksichtigt. Um das Mapping für einen Methodenaufruf zu deaktivieren, kann das 
            <a class="code" href="#options">options</a> Objekt Property 
            <a class="code" href="#optionalIgnoreMapping">ignoreMapping</a> verwendet werden.
            Ein <a class="code" href="#optionalHandler">errorHandler</a> kann über das 
            <a class="code" href="#options">options</a> Objekt angehängt werden.</p>
            
            <div class="example">ro.zugferd.addMapping("Rechnung", "380");
ro.zugferd.addMapping("Stück", "C62");
ro.zugferd.addMapping("Deutschland", "DE");</div>
        </div>
        
        <div>
            <h3>set(zugferdProperty, value, <a href="#options">options</a>?)</h3>
            
            <p>Setzt das angegebene ZUGFeRD-Property auf den spezifizierten Wert.
            Der Wert kann mit dem <a class="code" href="#options">options</a> Objekt modifiziert werden.</p>
            
            <div class="example">ro.zugferd.set("zugferd-profile", "basic");</div>
        </div>
        
        <div>
            <h3>setFromSelector(zugferdProperty, selector, <a href="#options">options</a>?)</h3>
            
            <p>Ruft über den angegebenen Selektor den Inhalt eines Elements des Dokuments ab 
            und setzt diesen als Wert für das angegebenen ZUGFeRD-Property. Der Inhalt des 
            ZUGFeRD-Elements kann mit dem <a class="code" href="#options">options</a> Objekt 
            modifiziert werden.</p>
            
            <div class="example">ro.zugferd.setFromSelector("grand-total", "#grandTotal", { inputFormat: "." });</div>
        </div>
        
        <div>
            <h3>setFromSelectorAll(zugferdProperty, selector, <a href="#options">options</a>?)</h3>
            
            <p>Ruft den Textinhalt jedes Elements ab, das auf den spezifizierten Selektor zutrifft 
            und setzt diesen als Wert für das angegebenen ZUGFeRD-Property.
            Dabei werden, sofern nicht vorhanden, neue wiederholende Elemente erzeugt.
            Diese Methode ist nicht für ZUGFeRD-Properties erlaubt, die mehrere
            <a href="#path">Pfad</a> Fragmente beinhalten. Für diese ZUGFeRD-Properties 
            sollte die Methode setFromSelectorAll mit dem Selektor Array verwendet werden.
            Der Inhalt des Elements kann mit dem <a class="code" href="#options">options</a> 
            Objekt modifiziert werden.</p>
            
            <div class="example">ro.zugferd.setFromSelectorAll("item.name", ".items .ProduktName");</div>
        </div>
        
        <div>
            <h3>setFromSelectorAll(zugferdProperty, selector[], <a href="#options">options</a>?)</h3>
            
            <p>Bei der Benutzung dieser Methode kann für jedes <a href="#fragments">Fragment</a>
            des ZUGFeRD-Propertys ein eigener Selektor angegeben werden. Werden mehr Selektoren
            angegeben als Fragmente vorhanden sind, wird der Methodenzugriff terminiert.
            Beschreibt der Selektor ein <a href="#path">Pfad</a> Fragment, so werden
            neue wiederholende Elemente erzeugt. Die Anzahl der neu erzeugten Elemente ist abhängig
            von den gefundenen Dokumentelementen und der bisherigen Anzahl an Elementen mit diesem
            Pfad.
            Um nur direkte Kindelemente zu selektieren, kann vor jedem Selektor nach dem 
            ersten ein "&gt;" angegeben werden. Der Inhalt des ZUGFeRD-Elements kann mit 
            dem <a class="code" href="#options">options</a> Objekt modifiziert werden.</p>
            
            <div class="example">// Einfach geschachtelte Elemente
ro.zugferd.setFromSelectorAll("item.name", [".items", ".ProduktName"] );

// Mehrfach geschachtelte Elemente
// ".tax" beinhaltet den zu setzenden Wert.
ro.zugferd.setFromSelectorAll("item.tax.percent", [".items", ".tax"] );

// ".tax" beinhaltet nicht den zu setzenden Wert.
ro.zugferd.setFromSelectorAll("item.tax.percent", [".items", ".tax", ".percent"] );

// > Selektor
ro.zugferd.setFromSelectorAll("item.tax.percent", [".items", "> tr:nth-child(2)"] );</div>
        </div>
        
        <div>
            <h3>get(pathFragment, index, <a href="#options">options</a>?)</h3>
            
            <p>Gibt das wiederholende Element mit dem spezifizierten <a href="#path">Pfad</a>
            und Index zurück. Gibt es kein wiederholendes Element mit diesem Index wird das 
            ZUGFeRD-Element sowie alle vorhergehenden Elemente erzeugt. Ein 
            <a class="code" href="#optionalHandler">errorHandler</a> kann über das 
            <a class="code" href="#options">options</a> Objekt angehängt werden.</p>
            
            <div class="example">ro.zugferd.get("item", 3);</div>
        </div>
        
        <div>
            <h3>get(pathFragment, <a href="#options">options</a>?)</h3>
            
            <p>Gibt ein Array aus allen wiederholenden Elementen mit dem angegebenen 
            <a href="#path">Pfad</a> zurück. Gibt es kein wiederholendes Element 
            mit dem Pfad, wird im <a class="code" href="#optionalHandler">errorHandler</a> 
            ein Error vom <a class="code" href="#errorType">errorType</a> 5000 geloggt. Ein 
            <a class="code" href="#optionalHandler">errorHandler</a> kann über das 
            <a class="code" href="#options">options</a> Objekt angehängt werden.
            Das zurückgegebene Array ist <strong>nicht</strong> live, Werte die auf Elemente dieses
            Arrays gesetzt werden, werden dennoch auf die Elemente angewandt.</p>
            
            <div class="example">ro.zugferd.get("item");</div>
        </div>
        
        
        
        <h2>Elemente</h2>
        
        <p>Elemente sind die wiederholenden Elemente, die über die <code>ro.zugferd</code> get Methoden zurückgegeben wurden.</p>
        
        <div>
            <h3>set(propertyFragment, value, <a href="#options">options</a>?)</h3>
            
            <p>Setzt das angegebene <a href="#property">Property</a> Fragment auf den spezifizierten Wert.
            Der Wert kann mit dem <a class="code" href="#options">options</a> 
            Objekt modifiziert werden.</p>
            
            <div class="example">// Setzen des Produktnamens
// Einzelnes Element
ro.zugferd.get("item", 3).set("name", "Muster Produkt");

// Mehrere Elemente
ro.zugferd.get("item").forEach( function (param) {
    param.set("name", "Muster Produkt");
});</div>
        </div>
        
        <div>
            <h3>setFromSelector(propertyFragment, selector, <a class="code" href="#options">options</a>?)</h3>
            
            <p>Ruft über den angegebenen Selektor den Inhalt eines Elements ab und setzt diesen 
            als Wert für das angegebenen <a href="#property">Property</a> Fragment. 
            Der Inhalt des ZUGFeRD-Elements kann mit dem <a class="code" href="#options">options</a> 
            Objekt modifiziert werden.</p>
            
            <div class="example">// Setzen des Produktnamens
// Einzelnes Element
ro.zugferd.get("item", 3).setFromSelector("name", "#spezifischerItemName");

// Mehrere Elemente
var items = ro.zugferd.get("item");
for (var i = 0; i &lt; items.length; i++) {
    items[i].setFromSelector("name", ".items:nth-child(" + (i + 1) + ") .ProduktName");
}</div>
        </div>
        
        <div>
            <h3>get(pathFragment, index, <a href="#options">options</a>?)</h3>
            
            <p>Wird diese Methode auf einem wiederholenden Element aufgerufen, so wird das
            verschachtelte wiederholende Element mit dem angegebenen <a href="#path">Pfad</a>
            Fragment an dem angegebenen Index zurückgegeben. Gibt es kein wiederholendes 
            Element an dem Index, so werden das Element, sowie alle vorhergehenden Elemente 
            erzeugt.
            Ein <a class="code" href="#optionalHandler">errorHandler</a> kann über das 
            <a class="code" href="#options">options</a> Objekt angehängt werden.</p>
            
            <div class="example">var item = ro.zugferd.get("item", 3);

item.get("tax", 3);</div>
        </div>
        
        <div>
            <h3>get(pathFragment, <a href="#options">options</a>?)</h3>
            
            <p>Wird diese Methode auf einem wiederholenden Element aufgerufen, so wird ein
            Array bestehend aus allen verschachtelte wiederholenden Elementen mit dem angegebenen
            <a href="#path">Pfad</a> Fragment zurückgegeben.
            Gibt es keine Elemente mit dem <a href="#path">Pfad</a> Fragment
            wird im <a class="code" href="#optionalHandler">errorHandler</a> ein <code>error</code> 
            vom <a href="#errorType">errorType</a> 5000 geloggt.
            Ein <a class="code" href="#optionalHandler">errorHandler</a> kann 
            über das <a class="code" href="#options">options</a> Objekt angehängt werden.
            Das zurückgegebene Array ist <strong>nicht</strong> live, Werte die auf Elemente dieses
            Arrays gesetzt werden, werden dennoch auf die Elemente angewandt.</p>
            
            <div class="example">var item = ro.zugferd.get("item", 3);

item.get("tax");</div>
        </div>
        
        
        
        
        <h2 id="options">Das "options" Objekt</h2>
        <p>Das "options" Objekt kann einer Methode übergeben werden, um Texte zu modifizieren 
        und um benötigte Informationen anzugeben. Bei ZUGFeRD-Properties vom Typ <code>Date</code> 
        oder <code>Number</code> wird dieses Objekt immer benötigt, es sei denn die benötigten
        Informationen wurden bereits über die <a class="code" href="#default">default</a> 
        Objekt Properties <code>inputFormat</code> und <code>scheme</code> angegeben. 
        Wurden Informationen für das gleiche Property sowohl im <code>options</code> als 
        auch im <code>default</code> Objekt angegeben, so werden nur die Informationen des 
        <code>options</code> Objekts berücksichtigt.</p>
        
        <div>
            <h3>inputFormat</h3>
            
            <p>Das <i>inputFormat</i> wird für ZUGFeRD-Properties von den Typen <code>Date</code> 
            und <code>Number</code> benötigt. Für ZUGFeRD-Properties vom Typ <code>Date</code> 
            wird das aktuelle Datumsformat als Java Pattern angegeben. Sollte es sich um ein 
            Property des Typs <code>Number</code> handeln, so muss das Dezimaltrennzeichen 
            angegeben werden. Das <code>inputFormat</code> wird nur in diesen beiden Fällen 
            ausgewertet und verarbeitet. Der Default Wert für ZUGFeRD-Properties des Typs 
            <code>Number</code> ist "<code>,</code>".</p>
            
            <div class="example">// Date
ro.zugferd.set("buyer-order-reference-issue-date", "26.05.2017", { inputFormat: "dd.MM.yyyy" } );

// Number
ro.zugferd.set("line-total", "12,550.85", { inputFormat: "." } );</div>
        </div>
        
        <div>
            <h3>scheme</h3>
            
            <p>Um das Ausgabeformat eines ZUGFeRD-Propertys vom Typ <code>Date</code> anzugeben 
            wird das Property <code>scheme</code> benötigt. Das Format wird als einer der 
            von ZUGFeRD spezifizierten Codes angegeben. Eine Ausnahme stellen hierbei 
            ZUGFeRD-Properties des Typs <code>Date</code> dar. Diese benötigen kein Ausgabeformat.
            Eine weitere Anwendung findet <code>scheme</code> bei <code>Global ID</code>s.
            Die Codes sind in der Propertyliste unter dem jeweiligen Typ zu finden. Das 
            Property <code>scheme</code> wird nur in diesen beiden Fällen ausgewertet und 
            verarbeitet. Der Default Wert für ZUGFeRD-Properties des Typs 
            <code>Date</code> ist <code>102</code>.</p>
            
            <div class="example">// Date 
ro.zugferd.set("document-issue-date", "26.05.2017", { inputFormat: "dd.MM.yyyy", scheme: "102" } );

// Global ID
ro.zugferd.set("seller-global-id", "4000001123452", { scheme: "0088" } );</div>
        </div>
        <div>
            <h3>startDelimiter</h3>
            
            <p>Das Property <code>startDelimiter</code> kürzt einen Text vom <strong>ersten</strong> 
            Vorkommen des Delimiters bis zum Ende des Texts, sofern kein <code>endDelimiter</code> angegeben wurde.</p>
            
            <div class="example">ro.zugferd.set("seller-city", "66435 Frankfurt/M", { startDelimiter: " " });
// Ergebnis: "Frankfurt/M"</div>
        </div>
        <div>
            <h3>endDelimiter</h3>
            
            <p>Das Property <code>endDelimiter</code> kürzt einen Text vom Anfang des Texts
            (oder ab dem ersten <code>startDelimiter</code>) bis zum <strong>letzten</strong> 
            Vorkommen des Delimiters.</p>
            
            <div class="example">ro.zugferd.set("seller-postcode", "66435 Frankfurt/M", { endDelimiter: " " });
// Ergebnis: "66435"</div>
        </div>
        <div>
            <h3>splitDelimiter</h3>
            
            <p>Mit Hilfe des Propertys <code>splitDelimiter</code> wird ein Text am angegeben 
            Delimiter geteilt. Über das Property <code>splitIndex</code> kann dann das 
            gewünschte Fragment ausgewählt werden.</p>
        </div>
        <div>
            <h3>splitIndex</h3>
            
            <p>Nachdem ein Text am <code>splitDelimiter</code> fragmentiert wurde, kann mit 
            Hilfe des Propertys <code>splitIndex</code> ein Fragment ausgewählt werden. 
            Wurde kein <code>splitDelimiter</code> angegeben, kann auch kein Fragment ausgewählt
            werden. Das erste Fragment hat den Index 0.</p>
            
            <div class="example">ro.zugferd.set("zugferd-profile", "Das ZUGFeRD Profil ist basic", { splitDelimiter: " ", splitIndex: 4 });
// Ergebnis
// "basic"</div>
        </div>
        <div>
            <h3>processor</h3>
            
            <p>Über das Property <code>processor</code> kann einer Methode eine eigene Funktion 
            übergeben werden. So können weitere Textmanipulationen anhand von bestimmten 
            Bedingungen durchgeführt werden. Außerdem ist es möglich die Properties 
            <code>inputFormat</code> und <code>scheme</code> zu setzen oder zu verändern.
            Folgende <strong>read-only</strong> Properties stehen als Parameter zur Verfügung:</p>
            
            <table>
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Typ</th>
                        <th>Beschreibung</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td class="code">rawText</td>
                        <td>String</td>
                        <td>Gibt den unverarbeiteten Text zurück.</td>
                    </tr>
                    <tr>
                        <td class="code">text</td>
                        <td>String</td>
                        <td>Gibt den verarbeiteten Text zurück.</td>
                    </tr>
                    <tr>
                        <td class="code">propertyName</td>
                        <td>String</td>
                        <td>Gibt den Namen des Propertys zurück, mit welchem die Methode 
                        aufgerufen wurde.</td>
                    </tr>
                    <tr>
                        <td class="code">element</td>
                        <td>Element</td>
                        <td>Gibt das über den Selektor abgerufene Element zurück.</td>
                    </tr>
                    <tr>
                        <td class="code">content</td>
                        <td>String</td>
                        <td>Gibt den Textinhalt des Elements, einschließlich des generierten 
                        <i>before</i> und <i>after</i> Textinhalts, zurück.</td>
                    </tr>
                    <tr>
                        <td class="code">contentBefore</td>
                        <td>String</td>
                        <td>Gibt den generierten <i>before</i> Textinhalt des Elements zurück.</td>
                    </tr>
                    <tr>
                        <td class="code">contentAfter</td>
                        <td>String</td>
                        <td>Gibt den generierten <i>after</i> Textinhalt des Elements zurück.</td>
                    </tr>
                    <tr>
                        <td class="code">contentText</td>
                        <td>String</td>
                        <td>Gibt den Textinhalt des Elements zurück</td>
                    </tr>
                </tbody>
            </table>
            
            <div class="example">// Benötigt kein inputFormat, da es sich bei tax.category nicht um den Typ "Number" handelt.
ro.zugferd.set("tax.category", "19.00", { processor: function (param) {
        if (param.text == "19.00" || param.text == "7.00") {
            return "S";     // Einheitssatz
        }
    }
});

// Änderung des Dezimaltrennzeichens
ro.zugferd.set("tax.percent", "19.00", { processor: function (param) {
        if (param.text.indexOf(".") !== -1) {
            param.inputFormat = ".";
        }
        else {
            param.inputFormat = ",";
        }
    }
});
</div>
        </div>
        
        <div>
            <h3 id="optionalIgnoreMapping">ignoreMapping</h3>
            
            <p>Falls ein Mapping für ein bestimmtes ZUGFeRD-Property deaktiviert werden soll, 
            so kann dies mit <code>ignoreMapping</code> erreicht werden.</p>
            
            <div class="example">// Mapping von "Rechnung" auf den ZUGFeRD Code "380".
ro.zugferd.addMapping("Rechnung", "380");

// Name des Dokuments soll "Rechnung" bleiben
ro.zugferd.set("document-name", "Rechnung", { ignoreMapping: true });

// Typ des Dokuments soll "380" sein.
ro.zugferd.set("document-type", "Rechnung");</div>
            
        </div>
        <div>
            <h3 id="optionalHandler">errorHandler</h3>
            
            <p>Mit dem Property <code>errorHandler</code> ist es möglich Fehlerfälle zu erkennen 
            und diese zu analysieren. Außerdem können verschiedene Informationen zum aktuellen 
            Verarbeitungsschritt abgefragt werden. Folgende Informationen können abgefragt werden:</p>
            
            <table>
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Typ</th>
                        <th>Beschreibung</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td class="code">methodName</td>
                        <td>String</td>
                        <td>Der Name der Methode.</td>
                    </tr>
                    <tr>
                        <td class="code">propertyName</td>
                        <td>String</td>
                        <td>Der Name des ZUGFeRD-Propertys oder der Key beim Aufruf von 
                        <code>addMapping</code></td>
                    </tr>
                    <tr>
                        <td class="code">value</td>
                        <td>String</td>
                        <td>Der Wert der der Methode <code>set</code> oder <code>addMapping</code> 
                        übergeben wurde.</td>
                    </tr>
                    <tr>
                        <td class="code">selectors</td>
                        <td>String oder [String]</td>
                        <td>Im Falle von <code>setFromSelector</code> der angegebene Selektor, 
                        bzw. ein Array von Selektoren im Falle von <code>setFromSelectorAll</code>.</td>
                    </tr>
                    <tr>
                        <td class="code">options</td>
                        <td>Object</td>
                        <td>Das <a class="code" href="#options">options</a> Objekt welches 
                        der Methode übergeben wurde.</td>
                    </tr>
                    <tr>
                        <td class="code">message</td>
                        <td>String</td>
                        <td>Die Nachricht des Errors, der Warning oder der Info.</td>
                    </tr>
                    <tr>
                        <td class="code">errorType</td>
                        <td>Number</td>
                        <td>Der Typ der <code>warning</code> oder des <code>error</code>s. 
                        Bei <code>info</code> liegt kein Typ vor. Mehr Informationen zu den 
                        Typen finden sich <a href="#errorType">hier</a>.</td>
                    </tr>
                    <tr>
                        <td class="code">level</td>
                        <td>String</td>
                        <td>Der Loglevel. Folgende Levels können vorliegen:
                        <ul>
                            <li><code>info</code>:    Informationen bezüglich neu erstellter ZUGFeRD-Elemente.</li>
                            <li><code>warning</code>: Warnungen beenden die Konvertierung nicht. 
                                Informationen zur Ursache der Warnung finden sich im Property <code>message</code>.</li>
                            <li><code>error</code>:   Errors beenden die Konvertierung 
                                <strong>nicht</strong>, können aber zu Folgefehlern oder 
                                ungültigem ZUGFeRD PDF führen. Informationen zur Ursache 
                                des Fehlers finden sich im Property <code>message</code>.</li>
                        </ul></td>
                    </tr>
                    <tr>
                        <td class="code">matchCount</td>
                        <td>[Number]</td>
                        <td>Das Property <code>matchCount</code> beinhaltet auf Level <code>info</code> 
                        ein Array von Zahlen, welches angibt wie viele Elemente im Dokument 
                        mit dem angegebenen Selektor gefunden wurden.</td>
                    </tr>
                </tbody>
            </table>
            
            <div class="example">ro.zugferd.set("document-issue-date", "2017-06-06", { errorHandler: function (param) {
        if (param.level == "error") {
            console.log(param.level);
            console.log(param.errorType);
            console.log(param.message);
        }
    }
});</div>
        
            <p><strong>Anmerkung:</strong> Wurde kein <code>errorHandler</code> über das Options oder
            dem Default Objekt angegeben, ist es nicht möglich aktuelle Informationen abzufragen und
            mögliche Fehlerfälle zu analysieren.</p>
        </div>
        
        <h2 id="default">Das "default" Objekt</h2>
        
        <p>Mit dem <code>default</code> Objekt können die Properties <code>inputFormat</code> 
        und <code>scheme</code> auf einer globalen Ebene angegeben werden. Die Werte der 
        Properties werden verwendet, sofern diese nicht über das <a class="code" href="#options">options</a> 
        Objekt angegeben wurden und der Typ des ZUGFeRD-Propertys diese verlangt. Außerdem 
        ist es möglich für wiederholende Elemente Standardwerte anzugeben.</p>
        
        <div>
            <h3>inputFormat</h3>
            
            <p>Über das Property <code>inputFormat</code> können Standardwerte für 
            ZUGFeRD-Properties des Typs <code>Date</code> sowie des Typs <code>Number</code> gesetzt werden.</p>
            
            <table>
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Beschreibung</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td class="code">dateFormat</td>
                        <td>Angabe des Eingabeformats als Java Date Format Pattern.</td>
                    </tr>
                    <tr>
                        <td class="code">decimalMark</td>
                        <td>Angabe eines Dezimaltrennzeichens zur Verarbeitung von 
                        ZUGFeRD-Properties des Typs <i>Number</i>. Der Standardwert ist "<code>,</code>".</td>
                    </tr>
                </tbody>
            </table>
            
            
        </div>
        <div>
            <h3>scheme</h3>
            
            <p>Über das Property <code>scheme</code> können Standardwerte für das Ausgabeformat 
            von ZUGFeRD-Properties der Typen <code>Date</code> und <code>Global ID</code> gesetzt werden.</p>
            
            <table>
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Beschreibung</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td class="code">dateFormat</td>
                        <td>Angabe des Ausgabeformats des Datums als ZUGFeRD Codes. Die Codeliste 
                        ist in der Propertyliste unter dem Typ <code>Date</code> zu finden.
                        Der Standardwert ist <code>102</code>.</td>
                    </tr>
                    <tr>
                        <td class="code">globalId</td>
                        <td>Angabe der Organisation unter welcher die <code>Global ID</code> 
                        registriert ist. Ein Auszug der möglichen Codes findet sich in der 
                        Propertyliste unter dem Typ <code>Global ID</code>. Für die Angabe 
                        der Organisation bei dem ZUGFeRD-Property <code>item.global-id</code> wird dieses
                        Property jedoch nicht ausgewährtet. Um den ZUGFeRD Code für die Organisation
                        anzugeben steht das ZUGFeRD-Property <code>item.global-id-type</code>
                        zur Verfügung.
                    </tr>
                </tbody>
            </table>
        </div>
        
        <div>
            <h3>propertyValues</h3>
            
            <p>Mit Hilfe des Propertys <code>propertyValues</code> können Standardwerte für 
            wiederholende Elemente gesetzt werden. Die Syntax ist wie folgt:</p>
            
            <div class="example">propertyValues: { 
    "propertyName": "Wert",
    "propertyName": "Wert"
};</div>
            
        </div>
        
        <div>
            <h3>errorHandler</h3>
            
            <p>Das Property <code>errorHandler</code> ist in seiner Funktion gleich dem des 
            <a class="code" href="#options">options</a> Objekts.
            Wird ein <code>errorHandler</code> als Standardwert angegeben so wird dieser bei 
            jedem Methodenaufruf, bei dem kein expliziter 
            <a class="code" href="#optionalHandler">errorHandler</a> im options Objekt 
            angegebene wurde, benutzt.</p>
        </div>
        
        <p>Ein möglicher Anwendungsfall kann wie folgt aussehen:</p>
        
        <div class="example">ro.zugferd.defaults = {
    inputFormat: { dateFormat: "dd-MM-yyyy", decimalMark: "." },
    scheme: { globalid: "0088", dateFormat: "102"  },
    propertyValues: { "tax.type": "VAT",
                      "item.tax.type": "VAT"
                    }
    errorHandler: function (param) {
        if (param.level == "error") {
            console.log(param.level);
            console.log(param.errorType);
            console.log(param.message);
        }
    }
};</div>
        
        
        <h2 id="errorType">ErrorTypes</h2>
        
        <p>Im Falle einer <code>warning</code> oder eines <code>errors</code> kann anhand 
        folgender Typen das Problem zusammengefasst werden. Eine genauere Beschreibung ist 
        im Property <code>message</code> des <a class="code" href="#optionalHandler">errorhandler</a>s
        zu finden.</p>
        
        <table>
            <thead>
                <tr>
                    <th>Typ</th>
                    <th>Beschreibung</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td class="code">1000</td>
                    <td>Fehler in der Verwendung der API.</td>
                </tr>
                <tr>
                    <td class="code">2000</td>
                    <td>Der Wert oder Textinhalt eines Elements konnte nicht mit dem 
                    angegeben <a class="code" href="#options">options</a> Objekt verarbeitet 
                    werden.</td>
                </tr>
                <tr>
                    <td class="code">3000</td>
                    <td>Der Wert oder Textinhalt eines Elements ist ungültig oder ungültig 
                    für dieses ZUGFeRD-Property.</td>
                </tr>
                <tr>
                    <td class="code">4000</td>
                    <td>Der Wert oder Textinhalt eines Elements konnte nicht verarbeitet 
                    werden. Dies tritt nur bei ZUGFeRD-Properties vom Typ <code>Date</code> 
                    oder <code>Number</code> auf.</td>
                </tr>
                <tr>
                    <td class="code">5000</td>
                    <td>Fehler beim <code>get</code> Zugriff auf wiederholende Elemente oder 
                    wenn keine Elemente mit dem angegebenen Selektor im Dokument gefunden wurden.</td>
                </tr>
            </tbody>
        </table>
    </body>
</html>
